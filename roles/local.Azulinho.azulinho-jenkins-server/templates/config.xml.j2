<?xml version='1.0' encoding='UTF-8'?>
<hudson>
{% set cfg=azulinho_jenkins_server %}
  <disabledAdministrativeMonitors/>
  <version>1.609</version>
  <numExecutors>{{ cfg['numExecutors'] | default(2) }}</numExecutors>
  <mode>{{ cfg['mode'] | default('NORMAL') }}</mode>
  <useSecurity>{{ cfg['useSecurity'] | default('true') }}</useSecurity>
  <authorizationStrategy class="hudson.security.AuthorizationStrategy$Unsecured"/>
  <securityRealm class="hudson.security.SecurityRealm$None"/>
  <disableRememberMe>{{ cfg['disableRememberMe'] | default('false') }}</disableRememberMe>
  <projectNamingStrategy class="jenkins.model.ProjectNamingStrategy$DefaultProjectNamingStrategy"/>
  <workspaceDir>{{ cfg['workspaceDir'] | default('${ITEM_ROOTDIR}/workspace') }}</workspaceDir>
  <buildsDir>{{cfg['buildsDir'] | default('${ITEM_ROOTDIR}/builds') }}</buildsDir>
  <jdks/>
  <viewsTabBar class="hudson.views.DefaultViewsTabBar"/>
  <myViewsTabBar class="hudson.views.DefaultMyViewsTabBar"/>
  <clouds>
{%  if cfg.clouds is defined %}

{%      if cfg.clouds.ec2_plugin is defined %}
{%          for item in cfg.clouds.ec2_plugin %}
    <hudson.plugins.ec2.EC2Cloud plugin="ec2@1.28">
      <name>{{item.name}}</name>
      <useInstanceProfileForCredentials>{{ item.useInstanceProfileForCredentials | default('false') }}</useInstanceProfileForCredentials>
      <accessId>{{ item.accessId }}</accessId>
      <secretKey>{{ item.secretKey}}</secretKey>
      <privateKey>
{%              for pk in item.privatekeys %}
        <privateKey>{{ pk | join("\n") }}</privateKey>
{%              endfor                        %}
      </privateKey>
      <instanceCap>{{ item.instanceCap | default('1')}}</instanceCap>
      <templates>
{%              for t in item.templates %}
        <hudson.plugins.ec2.SlaveTemplate>
          <ami>{{ t.ami }}</ami>
          <description>{{ t.description }}</description>
          <zone>{{ t.zone }}</zone>
          <securityGroups>{{ t.securityGroups }}</securityGroups>
          <remoteFS>{{ t.remoteFS |default('/tmp') }}</remoteFS>
          <type>{{ t.type | default('T2Micro')}}</type>
          <labels>{{ t.labels }}</labels>
          <mode>{{t.mode |default('NORMAL')}}</mode>
          <initScript>
{%                  for command in t.initscript %}
{{ command }}
{%                  endfor %}
          </initScript>
          <tmpDir>{{t.tmpDir |default('') }}</tmpDir>
          <userData>{{ t.userData |default('') }}</userData>
          <numExecutors>{{ t.numExecutors |default('1') }}</numExecutors>
          <remoteAdmin>{{ t.remoteAdmin }}</remoteAdmin>
          <jvmopts>{{ t.jvmopts |default('')}}</jvmopts>
          <subnetId>{{ t.subnetId |default('') }}</subnetId>
          <idleTerminationMinutes>{{ t.idleTerminationMinutes | default('1') }}</idleTerminationMinutes>
          <iamInstanceProfile>{{ t.iamInstanceProfile |default('') }}</iamInstanceProfile>
          <useEphemeralDevices>{{ t.useEphemeralDevices |default('false')}}</useEphemeralDevices>
          <customDeviceMapping>{{ t.customDeviceMapping|default('')}}</customDeviceMapping>
          <instanceCap>{{ t.instanceCap }}</instanceCap>
          <stopOnTerminate>{{ t.stopOnTerminate |default('false')}}</stopOnTerminate>
          <tags>
{%                  for tag in t.tags %}
            <hudson.plugins.ec2.EC2Tag>
            <name>{{ tag.name }}</name>
            <value>{{ tag.value }}</value>
            </hudson.plugins.ec2.EC2Tag>
{%                  endfor            %}
          </tags>
          <usePrivateDnsName>{{ t.usePrivateDnsName |default('false')}}</usePrivateDnsName>
          <associatePublicIp>{{ t.associatePublicIp | default('false')}}</associatePublicIp>
          <useDedicatedTenancy>false</useDedicatedTenancy>
          <amiType class="hudson.plugins.ec2.UnixData">
            <rootCommandPrefix>{{ t.rootCommandPrefix }}</rootCommandPrefix>
            <sshPort>{{ t.sshPort |default('22')}}</sshPort>
          </amiType>
          <launchTimeout>{{t.launchTimeout|default('2147483647')}}</launchTimeout>
          <connectBySSHProcess>{{t.connectBySSHProcess |default('true')}}</connectBySSHProcess>
        </hudson.plugins.ec2.SlaveTemplate>
{%              endfor                        %}
      </templates>
      <region>{{ item.region }}</region>
    </hudson.plugins.ec2.EC2Cloud>
{%       endfor %}
{%      endif  %}
{%  endif  %}
  </clouds>

  <quietPeriod>{{ cfg.quietPeriod | default('5')}}</quietPeriod>

  <slaves/>
  <scmCheckoutRetryCount>{{ cfg['scmCheckoutRetryCount'] | default('0') }}</scmCheckoutRetryCount>
  <views>
{# we always leave the default 'All' view #}

{%  if cfg.views is defined %}

{%      if cfg.views.list is defined %}
{%          for view in cfg.views.list %}
    <listView>
      <owner class="hudson" reference="../../.."/>
      <name>{{ view.name }}</name>
      <description>{{ view.description | default('') }}</description>
      <filterExecutors>{{ view.filterExecutors | default('true')}}</filterExecutors>
      <filterQueue>{{ view.filterQueue |default('true') }}</filterQueue>
      <properties class="hudson.model.View$PropertyList"/>
      <jobNames>
        <comparator class="hudson.util.CaseInsensitiveComparator"/>
      </jobNames>
      <jobFilters/>
      <columns>
{%              for col in view.columns %}
        <{{ col }}/>
{%              endfor %}
      </columns>
      <includeRegex>{{ view.includeRegex | default('') }}</includeRegex>
      <recurse>{{ view.recurse | default('false') }}</recurse>
    </listView>
{%          endfor %}
{%      endif %}
{%      if cfg.views.pipeline is defined %}
{%          for pipeline in cfg.views.pipeline %}
    <au.com.centrumsystems.hudson.plugin.buildpipeline.BuildPipelineView plugin="build-pipeline-plugin@1.4.5">
      <owner class="hudson" reference="../../.."/>
      <name>{{ pipeline.name }}</name>
      <filterExecutors>{{ pipeline.filterExecutors |default('true')}}</filterExecutors>
      <filterQueue>{{ pipeline.filterExecutors |default('true') }}</filterQueue>
      <properties class="hudson.model.View$PropertyList"/>
      <selectedJob>{{ pipeline.selectedJob }}</selectedJob>
      <gridBuilder class="au.com.centrumsystems.hudson.plugin.buildpipeline.DownstreamProjectGridBuilder">
      <firstJob>{{ pipeline.firstJob }}</firstJob>
      </gridBuilder>
      <noOfDisplayedBuilds>{{ pipeline.noOfDisplayedBuilds | default(5) }}</noOfDisplayedBuilds>
      <buildViewTitle>{{ pipeline.buildViewTitle |default('') }}</buildViewTitle>
      <consoleOutputLinkStyle>{{ pipeline.consoleOutputLinkStyle |default('Lightbox') }}</consoleOutputLinkStyle>
      <cssUrl></cssUrl>
      <triggerOnlyLatestJob>{{ pipeline.triggerOnlyLatestJob | default('false')}}</triggerOnlyLatestJob>
      <alwaysAllowManualTrigger>{{ pipeline.alwaysAllowManualTrigger |default('true') }}</alwaysAllowManualTrigger>
      <showPipelineParameters>{{ pipeline.showPipelineParameters |default('true')}}</showPipelineParameters>
      <showPipelineParametersInHeaders>{{ pipeline.showPipelineParametersInHeaders |default('false') }}</showPipelineParametersInHeaders>
      <startsWithParameters>{{ pipeline.startsWithParameters |default('false') }}</startsWithParameters>
      <refreshFrequency>{{ pipeline.refreshFrequency | default(60) }}</refreshFrequency>
      <showPipelineDefinitionHeader>{{ pipeline.showPipelineDefinitionHeader |default('false')}}</showPipelineDefinitionHeader>
    </au.com.centrumsystems.hudson.plugin.buildpipeline.BuildPipelineView>
{%          endfor %}
{%      endif %}
{%  endif %}
  </views>
  <primaryView>All</primaryView>
  <slaveAgentPort>0</slaveAgentPort>
  <label>{{ cfg.master_label | default('master')}}</label>
  <nodeProperties/>
  <globalNodeProperties/>
</hudson>
